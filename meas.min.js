var isOpera=!!window.opr&&!!opr.addons||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),isFirefox="undefined"!=typeof InstallTrigger,isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),isIE=!!document.documentMode,isEdge=window.navigator.userAgentData&&0<window.navigator.userAgentData.brands.filter(function(brand){return-1!==brand.brand.indexOf("Microsoft Edge")}).length,isChrome=!!window.chrome&&!isEdge,isBlink=(isChrome||isOpera)&&!!window.CSS,BrowserFlags={isOpera:isOpera,isFirefox:isFirefox,isSafari:isSafari,isIE:isIE,isEdge:isEdge,isChrome:isChrome,isBlink:isBlink};Object.freeze(BrowserFlags);var isWin=-1!=navigator.appVersion.indexOf("Win"),isMac=-1!=navigator.appVersion.indexOf("Mac"),isLinux=-1!=navigator.appVersion.indexOf("Linux"),isUnix=-1!=navigator.appVersion.indexOf("X11"),OsFlags={isWin:isWin,isMac:isMac,isUnix:isUnix,isLinux:isLinux};Object.freeze(OsFlags);var meas,MEAS_TYPE="measure",MARK_TYPE="mark";function TrackerProxy(section,name,options){this.name=name,this.section=section,this.section.start(name,options)}function Tracker(perPtr,name,options){this._perfPtr=perPtr,this.name=name,this.startName=name+"_start",this.endName=name+"_end",this.measName=name+"_meas",options&&(this.options=options),this.hasMeasured=!1,this._perfPtr.mark(this.startName)}function TrackerSection(perfPtr,name,trackerPrefix){this.perfPtr=perfPtr,this.name=name,this.trackerPrefix=trackerPrefix,this.enabled=!0,this.trackers={},this.sections={}}function ClearHelper(perfPtr){this.perfPtr=perfPtr}function LsHelper(perfPtr){this.perfPtr=perfPtr}function FindHelper(perfPtr){this.perfPtr=perfPtr}function PerfHelper(perfPtr){this.perfPtr=perfPtr,this.clearHelper=new ClearHelper(this.perfPtr),this.lsHelper=new LsHelper(this.perfPtr),this.findHelper=new FindHelper(this.perfPtr)}function TrackerManager(){this.trackers={},this.sections={},this.perfHelper=new PerfHelper(this.perfPtr),window?this.setPerfPtr(window.performance):this.setPerfPtr(self.performance),this.enabled=!0}TrackerProxy.prototype={end:function(){this.section.end(this.name)}},Tracker.prototype={end:function(){this.hasEnded||(this._perfPtr.mark(this.endName),this.hasEnded=!0)},endnmeas:function(name){return this.end(),this.meas()},meas:function(){return this.hasMeasured||(this._perfPtr.measure(this.measName,this.startName,this.endName),this.hasMeasured=!0),this._findmeas()},_findmeas:function(){for(var measures=this._perfPtr.getEntriesByType(MEAS_TYPE),i=0;i<measures.length;i++){var current=measures[i];if(current.name===this.measName)return current}},dump:function(prefix){var measures=this._perfPtr.getEntriesByType(MEAS_TYPE),that=this,filtered=measures.filter(function(m){return m.name===that.measName});if(this.options&&this.options.stats){for(var sum=0,min=Number.MAX_SAFE_INTEGER,max=Number.MIN_SAFE_INTEGER,len=filtered.length,i=0;i<len;i++){var dur=filtered[i].duration;sum+=dur,dur<min&&(min=dur),max<dur&&(max=dur)}for(var avg=sum/len,variance=0,j=0;j<len;j++){variance+=filtered[j].duration-avg^2}variance/=len;var stddev=Math.sqrt(variance);this.calculated={cnt:len,min:min,max:max,avg:avg,var:variance,stddev:stddev};var formatted="name="+this.name+", cnt="+len+" avg="+avg+", min="+min+", max="+max+", σ2="+variance+", σ="+stddev;console.log(formatted)}else{var len2=filtered.length;1<len2&&console.warn("there are more than one entry...maybe you should do stats");var current=filtered[len2-1];if(len2){this.calculated={duration:current.duration};var formatted2="name="+this.name+", value="+current.duration;console.log(formatted2)}}}},TrackerSection.prototype={create:function(trackerName,options){return new TrackerProxy(this,trackerName,options)},start:function(trackerName,options){if(this.enabled){var prefixedName=this.trackerPrefix+"."+trackerName;this.trackers[trackerName]&&this.trackers[trackerName].end(),this.trackers[trackerName]=new Tracker(this.perfPtr,prefixedName,options)}},end:function(trackerName){this.enabled&&this.trackers[trackerName]&&this.trackers[trackerName].end()},enable:function(enabled){this.enabled=enabled;for(var sectionKeys=Object.keys(this.sections),j=0;j<sectionKeys.length;j++){var sectionId=sectionKeys[j];this.sections[sectionId].enable(enabled)}},addOrGetSection:function(name){if(this.enabled){var check=this.sections[name];if(check)return check;var trackerPrefix=this.trackerPrefix+"."+name;return check=this.sections[name]=new TrackerSection(this.perfPtr,name,trackerPrefix)}},dump:function(prefix){var prefixPath=prefix||"";prefixPath.length?prefixPath+="."+this.name:prefixPath=this.name;for(var trackerKeys=Object.keys(this.trackers),i=0;i<trackerKeys.length;i++){var trackerId=trackerKeys[i];this.trackers[trackerId].meas(),this.trackers[trackerId].dump(prefixPath)}for(var sectionKeys=Object.keys(this.sections),j=0;j<sectionKeys.length;j++){var sectionId=sectionKeys[j];this.sections[sectionId].dump(prefixPath)}}},ClearHelper.prototype={_set:function(perfPtr){this.perfPtr=perfPtr},mark:function(){this.perfPtr.clearMarks()},meas:function(){this.perfPtr.clearMeasures()}},LsHelper.prototype={_set:function(perfPtr){this.perfPtr=perfPtr},mark:function(){for(var marks=this.perfPtr.getEntriesByType(MARK_TYPE),result=[],i=0;i<marks.length;i++)result.push(marks[i].name);return result},meas:function(){for(var marks=this.perfPtr.getEntriesByType(MEAS_TYPE),result=[],i=0;i<marks.length;i++)result.push(marks[i].name);return result}},FindHelper.prototype={_set:function(perfPtr){this.perfPtr=perfPtr},mark:function(context){for(var marks=this.perfPtr.getEntriesByType(MARK_TYPE),result=[],i=0;i<marks.length;i++){var current=marks[i];-1!==current.name.indexOf(context)&&result.push(current)}return result},meas:function(context){for(var meas=this.perfPtr.getEntriesByType(MEAS_TYPE),result=[],i=0;i<meas.length;i++){var current=meas[i];-1!==current.name.indexOf(context)&&result.push(current)}return result}},PerfHelper.prototype={_set:function(perfPtr){this._perfPtr=perfPtr,this.clearHelper._set(perfPtr),this.lsHelper._set(perfPtr),this.findHelper._set(perfPtr)}},Object.defineProperties(PerfHelper.prototype,{clr:{get:function(){return this.clearHelper}},ls:{get:function(){return this.lsHelper}},find:{get:function(){return this.findHelper}}}),TrackerManager.prototype={setPerfPtr:function(object){object.mark&&object.measure&&object.getEntriesByType&&(this._perfPtr=object,this.perfHelper._set(object),object.onresourcetimingbufferfull&&(object.onresourcetimingbufferfull=function(){console.error("You cannot make more marks and measures try upping your buffersize")}))},start:function(name){this.enabled&&(this.trackers[name]=new Tracker(this.perfPtr,name))},end:function(name){this.enabled&&this.trackers[name]&&this.trackers[name].end()},endnmeas:function(name){if(this.enabled)return this.trackers[name]?this.trackers[name].endnmeas():void 0},meas:function(name){if(this.enabled)return this.trackers[name]?this.trackers[name].meas():void 0},specificMeas:function(name,startMarkName,endMarkName){return this.perfPtr.measure(name,startMarkName,endMarkName),this.perfPtr.getEntriesByType("measure").filter(function(m){return m.name===name})},withMeas:function(name,callback){try{this.start(name),callback()}finally{this.end(name)}},addOrGetSection:function(name){if(this.enabled){var check=this.sections[name];return check?check:check=this.sections[name]=new TrackerSection(this.perfPtr,name,name)}},buildOrGetSection:function(sectionPath){for(var section,parts=sectionPath.split("."),i=0;i<parts.length;i++){var currentSection=parts[i];section=0===i?this.addOrGetSection(currentSection):section.addOrGetSection(currentSection)}return section},enable:function(enabled){this.enabled=enabled;for(var sectionKeys=Object.keys(this.sections),j=0;j<sectionKeys.length;j++){var sectionId=sectionKeys[j];this.sections[sectionId].enable(enabled)}},dump:function(){for(var sectionKeys=Object.keys(this.sections),j=0;j<sectionKeys.length;j++){var sectionId=sectionKeys[j];this.sections[sectionId].dump()}}},Object.defineProperties(TrackerManager.prototype,{BrowserFlags:{value:BrowserFlags,writable:!1},OsFlags:{value:OsFlags,writable:!1},perf:{get:function(){return this.perfHelper}},perfPtr:{get:function(){return this._perfPtr}},buffersize:{set:function(value){this._perfPtr.setResourceTimingBufferSize&&this._perfPtr.setResourceTimingBufferSize(value)}}}),meas||(meas=new TrackerManager,window?(window.meas=meas,window.top.meas=meas):self&&(self.meas=meas)),"function"==typeof define&&define.amd&&define(function(){return meas});